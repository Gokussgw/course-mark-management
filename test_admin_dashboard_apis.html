<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard API Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .success { color: green; }
        .error { color: red; }
        .info { color: blue; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Admin Dashboard API Test</h1>
    <div id="results"></div>
    <button onclick="testAdminDashboard()">Test Admin Dashboard</button>

    <script>
    async function testAdminDashboard() {
        const results = document.getElementById('results');
        results.innerHTML = '<p class="info">Testing admin dashboard...</p>';
        
        try {
            // Step 1: Login
            results.innerHTML += '<p><strong>Step 1: Admin Login</strong></p>';
            
            const loginResponse = await fetch('http://localhost:8000/api/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: 'admin@example.com',
                    password: 'admin123'
                })
            });
            
            if (!loginResponse.ok) {
                results.innerHTML += `<p class="error">❌ Login failed: ${loginResponse.status}</p>`;
                return;
            }
            
            const loginData = await loginResponse.json();
            const token = loginData.token;
            
            results.innerHTML += '<p class="success">✅ Login successful</p>';
            results.innerHTML += `<p>Token: ${token.substring(0, 50)}...</p>`;
            
            // Step 2: Test Stats API
            results.innerHTML += '<p><strong>Step 2: Test Admin Stats API</strong></p>';
            
            const statsResponse = await fetch('http://localhost:3000/api/admin/stats', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (statsResponse.ok) {
                const statsData = await statsResponse.json();
                results.innerHTML += '<p class="success">✅ Stats API working</p>';
                results.innerHTML += `<pre>${JSON.stringify(statsData, null, 2)}</pre>`;
            } else {
                results.innerHTML += `<p class="error">❌ Stats API failed: ${statsResponse.status}</p>`;
                const errorText = await statsResponse.text();
                results.innerHTML += `<p>Error: ${errorText}</p>`;
            }
            
            // Step 3: Test Users API
            results.innerHTML += '<p><strong>Step 3: Test Admin Users API</strong></p>';
            
            const usersResponse = await fetch('http://localhost:3000/api/admin/users', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            });
            
            if (usersResponse.ok) {
                const usersData = await usersResponse.json();
                results.innerHTML += '<p class="success">✅ Users API working</p>';
                results.innerHTML += `<p>Total users: ${usersData.length}</p>`;
                results.innerHTML += `<p>Sample users:</p>`;
                results.innerHTML += `<pre>${JSON.stringify(usersData.slice(0, 3), null, 2)}</pre>`;
            } else {
                results.innerHTML += `<p class="error">❌ Users API failed: ${usersResponse.status}</p>`;
                const errorText = await usersResponse.text();
                results.innerHTML += `<p>Error: ${errorText}</p>`;
            }
            
            // Step 4: Test localStorage simulation
            results.innerHTML += '<p><strong>Step 4: Simulate Vue App Auth Storage</strong></p>';
            
            // Store token like the Vue app would
            localStorage.setItem('token', token);
            localStorage.setItem('user', JSON.stringify(loginData.user));
            
            results.innerHTML += '<p class="success">✅ Token stored in localStorage</p>';
            results.innerHTML += '<p class="info">Now you can refresh the admin dashboard and it should work!</p>';
            
        } catch (error) {
            results.innerHTML += `<p class="error">❌ Error: ${error.message}</p>`;
        }
    }
    </script>
</body>
</html>
