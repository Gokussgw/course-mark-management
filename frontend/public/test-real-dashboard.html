<!DOCTYPE html>
<html>
  <head>
    <title>Test Real Student Dashboard Data</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
      }
      .section {
        margin-bottom: 30px;
        padding: 15px;
        border: 1px solid #ddd;
        border-radius: 5px;
      }
      .course {
        background: #f8f9fa;
        padding: 10px;
        margin: 5px 0;
        border-radius: 3px;
      }
      .assessment {
        background: #e9ecef;
        padding: 8px;
        margin: 3px 0;
        border-radius: 3px;
      }
      pre {
        background: #f8f9fa;
        padding: 10px;
        border-radius: 3px;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <h1>Real Student Dashboard Data Test</h1>
    <div id="result"></div>

    <script>
      async function testRealData() {
        const resultDiv = document.getElementById("result");
        const studentId = 4;

        try {
          // Fetch all dashboard data
          const [coursesResponse, assessmentsResponse, performanceResponse] =
            await Promise.all([
              fetch(
                `http://localhost:8000/marks-api.php?action=student_dashboard_courses&student_id=${studentId}`
              ),
              fetch(
                `http://localhost:8000/marks-api.php?action=student_dashboard_assessments&student_id=${studentId}`
              ),
              fetch(
                `http://localhost:8000/marks-api.php?action=student_dashboard_performance&student_id=${studentId}`
              ),
            ]);

          const coursesData = await coursesResponse.json();
          const assessmentsData = await assessmentsResponse.json();
          const performanceData = await performanceResponse.json();

          let html = '<div class="section"><h2>üìö Courses Data</h2>';
          if (coursesData.courses && coursesData.courses.length > 0) {
            coursesData.courses.forEach((course) => {
              html += `<div class="course">
                            <strong>${course.code} - ${course.name}</strong><br>
                            Lecturer: ${
                              course.lecturer_name || "Not assigned"
                            }<br>
                            Average: ${course.average}% | Progress: ${
                course.progress
              }% | Rank: ${course.rank}<br>
                            Semester: ${course.semester} ${course.academic_year}
                        </div>`;
            });
          } else {
            html += "<p>No courses found</p>";
          }
          html += "</div>";

          html += '<div class="section"><h2>üìù Upcoming Assessments</h2>';
          if (
            assessmentsData.assessments &&
            assessmentsData.assessments.length > 0
          ) {
            assessmentsData.assessments.forEach((assessment) => {
              html += `<div class="assessment">
                            <strong>${assessment.name}</strong> (${assessment.type})<br>
                            Course: ${assessment.course_code} - ${assessment.course_name}<br>
                            Date: ${assessment.date} | Weight: ${assessment.weightage}%
                        </div>`;
            });
          } else {
            html += "<p>No upcoming assessments</p>";
          }
          html += "</div>";

          html += '<div class="section"><h2>üìä Performance Chart Data</h2>';
          if (
            performanceData.performance &&
            performanceData.performance.datasets
          ) {
            html += `<p><strong>Labels:</strong> ${performanceData.performance.labels.join(
              ", "
            )}</p>`;
            html += "<h4>Datasets:</h4>";
            performanceData.performance.datasets.forEach((dataset) => {
              html += `<div style="margin: 10px 0;">
                            <strong>${
                              dataset.label
                            }:</strong> ${dataset.data.join(", ")}%
                        </div>`;
            });
          } else {
            html += "<p>No performance data</p>";
          }
          html += "</div>";

          html += '<div class="section"><h2>üîç Raw JSON Data</h2>';
          html +=
            "<h4>Courses JSON:</h4><pre>" +
            JSON.stringify(coursesData, null, 2) +
            "</pre>";
          html +=
            "<h4>Assessments JSON:</h4><pre>" +
            JSON.stringify(assessmentsData, null, 2) +
            "</pre>";
          html +=
            "<h4>Performance JSON:</h4><pre>" +
            JSON.stringify(performanceData, null, 2) +
            "</pre>";
          html += "</div>";

          resultDiv.innerHTML = html;
        } catch (error) {
          resultDiv.innerHTML = `<div style="color: red;">
                    <h2>‚ùå Error</h2>
                    <p>${error.message}</p>
                </div>`;
        }
      }

      testRealData();
    </script>
  </body>
</html>
