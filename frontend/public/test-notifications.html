<!DOCTYPE html>
<html>
  <head>
    <title>Test Notifications API</title>
  </head>
  <body>
    <h1>Testing Notifications</h1>
    <div id="result"></div>

    <script>
      async function testNotifications() {
        const userId = 4; // Test with student ID 4
        const resultDiv = document.getElementById("result");

        try {
          // Test unread count
          const unreadResponse = await fetch(
            `http://localhost:8000/marks-api.php?action=unread_notifications&user_id=${userId}`,
            {
              credentials: "include",
            }
          );
          const unreadData = await unreadResponse.json();

          // Test recent notifications
          const recentResponse = await fetch(
            `http://localhost:8000/marks-api.php?action=recent_notifications&user_id=${userId}&limit=5`,
            {
              credentials: "include",
            }
          );
          const recentData = await recentResponse.json();

          resultDiv.innerHTML = `
                    <h2>API Test Results:</h2>
                    <p><strong>Unread Count:</strong> ${
                      unreadData.unread_count
                    }</p>
                    <p><strong>Recent Notifications:</strong> ${
                      recentData.notifications
                        ? recentData.notifications.length
                        : 0
                    }</p>
                    <h3>Notifications:</h3>
                    <ul>
                        ${
                          recentData.notifications
                            ? recentData.notifications
                                .map(
                                  (n) =>
                                    `<li>${n.content} (${n.created_at})</li>`
                                )
                                .join("")
                            : "<li>No notifications</li>"
                        }
                    </ul>
                `;
        } catch (error) {
          resultDiv.innerHTML = `<p style="color: red;">Error: ${error.message}</p>`;
        }
      }

      // Run test when page loads
      testNotifications();
    </script>
  </body>
</html>
