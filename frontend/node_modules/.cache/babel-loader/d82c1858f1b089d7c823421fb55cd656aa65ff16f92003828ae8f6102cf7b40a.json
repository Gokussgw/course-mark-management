{"ast":null,"code":"import _toConsumableArray from \"C:/Users/ansmu/Desktop/Web/course-mark-management/frontend/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";\nimport _createForOfIteratorHelper from \"C:/Users/ansmu/Desktop/Web/course-mark-management/frontend/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper.js\";\nimport _regenerator from \"C:/Users/ansmu/Desktop/Web/course-mark-management/frontend/node_modules/@babel/runtime/helpers/esm/regenerator.js\";\nimport _asyncToGenerator from \"C:/Users/ansmu/Desktop/Web/course-mark-management/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport _objectSpread from \"C:/Users/ansmu/Desktop/Web/course-mark-management/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.error.cause.js\";\nimport \"core-js/modules/es.error.to-string.js\";\nimport \"core-js/modules/es.array.concat.js\";\nimport \"core-js/modules/es.array.filter.js\";\nimport \"core-js/modules/es.array.find.js\";\nimport \"core-js/modules/es.array.for-each.js\";\nimport \"core-js/modules/es.array.includes.js\";\nimport \"core-js/modules/es.array.join.js\";\nimport \"core-js/modules/es.array.map.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.reduce.js\";\nimport \"core-js/modules/es.date.to-iso-string.js\";\nimport \"core-js/modules/es.date.to-json.js\";\nimport \"core-js/modules/es.date.to-string.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.filter.js\";\nimport \"core-js/modules/es.iterator.find.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.map.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport \"core-js/modules/es.number.to-fixed.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/es.regexp.exec.js\";\nimport \"core-js/modules/es.regexp.test.js\";\nimport \"core-js/modules/es.string.includes.js\";\nimport \"core-js/modules/es.string.iterator.js\";\nimport \"core-js/modules/es.string.match.js\";\nimport \"core-js/modules/es.string.replace.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/web.dom-collections.iterator.js\";\nimport \"core-js/modules/web.url.js\";\nimport \"core-js/modules/web.url.to-json.js\";\nimport \"core-js/modules/web.url-search-params.js\";\nimport \"core-js/modules/web.url-search-params.delete.js\";\nimport \"core-js/modules/web.url-search-params.has.js\";\nimport \"core-js/modules/web.url-search-params.size.js\";\nimport { mapGetters } from 'vuex';\nimport * as bootstrap from 'bootstrap';\nexport default {\n  name: 'MarksManagement',\n  data: function data() {\n    return {\n      courseId: this.$route.params.courseId || '',\n      course: null,\n      students: [],\n      lecturerCourses: [],\n      isLoading: false,\n      unsavedChanges: false\n    };\n  },\n  computed: _objectSpread(_objectSpread({}, mapGetters('auth', ['getUser', 'userId'])), {}, {\n    currentUser: function currentUser() {\n      return this.getUser;\n    }\n  }),\n  created: function created() {\n    var _this = this;\n    return _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee() {\n      return _regenerator().w(function (_context) {\n        while (1) switch (_context.n) {\n          case 0:\n            console.log('MarksManagement component created');\n            console.log('Initial auth state:', {\n              user: _this.getUser,\n              userId: _this.userId,\n              isAuthenticated: _this.$store.getters['auth/isAuthenticated']\n            });\n\n            // Wait a bit for auth to be initialized if needed\n            _context.n = 1;\n            return _this.$nextTick();\n          case 1:\n            _context.n = 2;\n            return _this.loadLecturerCourses();\n          case 2:\n            if (!_this.courseId) {\n              _context.n = 3;\n              break;\n            }\n            _context.n = 3;\n            return _this.loadCourseData();\n          case 3:\n            return _context.a(2);\n        }\n      }, _callee);\n    }))();\n  },\n  methods: {\n    loadLecturerCourses: function loadLecturerCourses() {\n      var _this2 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {\n        var lecturerId, response, data, _t;\n        return _regenerator().w(function (_context2) {\n          while (1) switch (_context2.n) {\n            case 0:\n              _context2.p = 0;\n              console.log('Loading lecturer courses...');\n              console.log('User ID:', _this2.userId);\n              console.log('Current user:', _this2.currentUser);\n              if (_this2.userId) {\n                _context2.n = 1;\n                break;\n              }\n              throw new Error('User not authenticated');\n            case 1:\n              lecturerId = _this2.userId;\n              _context2.n = 2;\n              return fetch(\"http://localhost/marks-api.php?action=lecturer_courses&lecturer_id=\".concat(lecturerId), {\n                method: 'GET',\n                credentials: 'include',\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n            case 2:\n              response = _context2.v;\n              console.log('API Response status:', response.status);\n              if (response.ok) {\n                _context2.n = 3;\n                break;\n              }\n              throw new Error(\"HTTP error! status: \".concat(response.status));\n            case 3:\n              _context2.n = 4;\n              return response.json();\n            case 4:\n              data = _context2.v;\n              console.log('API Response data:', data);\n              if (!data.error) {\n                _context2.n = 5;\n                break;\n              }\n              throw new Error(data.error);\n            case 5:\n              _this2.lecturerCourses = data.courses || [];\n              console.log('Loaded lecturer courses:', _this2.lecturerCourses);\n              _context2.n = 7;\n              break;\n            case 6:\n              _context2.p = 6;\n              _t = _context2.v;\n              console.error('Error loading lecturer courses:', _t);\n              _this2.$store.dispatch('showToast', {\n                message: 'Error loading courses: ' + _t.message,\n                type: 'error'\n              });\n              _this2.lecturerCourses = [];\n            case 7:\n              return _context2.a(2);\n          }\n        }, _callee2, null, [[0, 6]]);\n      }))();\n    },\n    loadCourseData: function loadCourseData() {\n      var _this3 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3() {\n        var _t2;\n        return _regenerator().w(function (_context3) {\n          while (1) switch (_context3.n) {\n            case 0:\n              if (_this3.courseId) {\n                _context3.n = 1;\n                break;\n              }\n              return _context3.a(2);\n            case 1:\n              _this3.isLoading = true;\n              _context3.p = 2;\n              // Find the selected course\n              _this3.course = _this3.lecturerCourses.find(function (c) {\n                return c.id == _this3.courseId;\n              });\n\n              // Load students for this course with their marks\n              _context3.n = 3;\n              return _this3.loadStudentsWithMarks();\n            case 3:\n              _context3.n = 5;\n              break;\n            case 4:\n              _context3.p = 4;\n              _t2 = _context3.v;\n              console.error('Error loading course data:', _t2);\n              _this3.$store.dispatch('showToast', {\n                message: 'Error loading course data',\n                type: 'error'\n              });\n            case 5:\n              _context3.p = 5;\n              _this3.isLoading = false;\n              return _context3.f(5);\n            case 6:\n              return _context3.a(2);\n          }\n        }, _callee3, null, [[2, 4, 5, 6]]);\n      }))();\n    },\n    loadStudentsWithMarks: function loadStudentsWithMarks() {\n      var _this4 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4() {\n        var response, data, _t3;\n        return _regenerator().w(function (_context4) {\n          while (1) switch (_context4.n) {\n            case 0:\n              _context4.p = 0;\n              _context4.n = 1;\n              return fetch(\"http://localhost/marks-api.php?action=course_students_marks&course_id=\".concat(_this4.courseId), {\n                method: 'GET',\n                credentials: 'include',\n                headers: {\n                  'Content-Type': 'application/json'\n                }\n              });\n            case 1:\n              response = _context4.v;\n              if (response.ok) {\n                _context4.n = 2;\n                break;\n              }\n              throw new Error(\"HTTP error! status: \".concat(response.status));\n            case 2:\n              _context4.n = 3;\n              return response.json();\n            case 3:\n              data = _context4.v;\n              if (!data.error) {\n                _context4.n = 4;\n                break;\n              }\n              throw new Error(data.error);\n            case 4:\n              // Map the API response to the expected format\n              _this4.students = data.students.map(function (student) {\n                return {\n                  id: student.student_id,\n                  name: student.student_name,\n                  email: student.email || 'N/A',\n                  matric_number: student.matric_number,\n                  marks: {\n                    assignment: student.assignment_mark || 0,\n                    quiz: student.quiz_mark || 0,\n                    test: student.test_mark || 0,\n                    final_exam: student.final_exam_mark || 0,\n                    final_mark: student.final_grade || 0,\n                    grade: student.letter_grade || 'F'\n                  }\n                };\n              });\n\n              // Calculate final marks for all students to ensure they're up to date\n              _this4.students.forEach(function (student) {\n                _this4.calculateFinalMark(student);\n              });\n              console.log('Loaded students with marks:', _this4.students);\n              _context4.n = 6;\n              break;\n            case 5:\n              _context4.p = 5;\n              _t3 = _context4.v;\n              console.error('Error loading students with marks:', _t3);\n              _this4.$store.dispatch('showToast', {\n                message: 'Error loading student marks: ' + _t3.message,\n                type: 'error'\n              });\n\n              // Fallback to empty array\n              _this4.students = [];\n            case 6:\n              return _context4.a(2);\n          }\n        }, _callee4, null, [[0, 5]]);\n      }))();\n    },\n    calculateFinalMark: function calculateFinalMark(student) {\n      var marks = student.marks;\n\n      // Check if all marks are entered\n      var assignment = marks.assignment || 0;\n      var quiz = marks.quiz || 0;\n      var test = marks.test || 0;\n      var finalExam = marks.final_exam || 0;\n\n      // Calculate final mark: Components (70%) + Final Exam (30%)\n      // Components breakdown: Assignment (25%) + Quiz (20%) + Test (25%)\n      var componentMark = assignment * 0.25 + quiz * 0.20 + test * 0.25;\n      var finalMark = componentMark + finalExam * 0.30;\n      marks.final_mark = finalMark;\n      marks.grade = this.calculateGrade(finalMark);\n      this.unsavedChanges = true;\n    },\n    calculateGrade: function calculateGrade(finalMark) {\n      if (finalMark >= 80) return 'A';\n      if (finalMark >= 70) return 'B';\n      if (finalMark >= 60) return 'C';\n      if (finalMark >= 50) return 'D';\n      return 'F';\n    },\n    calculateAllFinalMarks: function calculateAllFinalMarks() {\n      var _this5 = this;\n      this.students.forEach(function (student) {\n        _this5.calculateFinalMark(student);\n      });\n      this.$store.dispatch('showToast', {\n        message: 'Final marks calculated for all students',\n        type: 'success'\n      });\n    },\n    saveStudentMarks: function saveStudentMarks(student) {\n      var _this6 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5() {\n        var lecturerId, requestData, response, data, _t4;\n        return _regenerator().w(function (_context5) {\n          while (1) switch (_context5.n) {\n            case 0:\n              _context5.p = 0;\n              if (_this6.userId) {\n                _context5.n = 1;\n                break;\n              }\n              throw new Error('User not authenticated');\n            case 1:\n              lecturerId = _this6.userId;\n              requestData = {\n                action: 'save_marks',\n                student_id: student.id,\n                course_id: _this6.courseId,\n                lecturer_id: lecturerId,\n                marks: {\n                  assignment: student.marks.assignment || 0,\n                  quiz: student.marks.quiz || 0,\n                  test: student.marks.test || 0,\n                  final_exam: student.marks.final_exam || 0\n                }\n              };\n              _context5.n = 2;\n              return fetch('http://localhost/marks-api.php', {\n                method: 'POST',\n                credentials: 'include',\n                headers: {\n                  'Content-Type': 'application/json'\n                },\n                body: JSON.stringify(requestData)\n              });\n            case 2:\n              response = _context5.v;\n              if (response.ok) {\n                _context5.n = 3;\n                break;\n              }\n              throw new Error(\"HTTP error! status: \".concat(response.status));\n            case 3:\n              _context5.n = 4;\n              return response.json();\n            case 4:\n              data = _context5.v;\n              if (!data.error) {\n                _context5.n = 5;\n                break;\n              }\n              throw new Error(data.error);\n            case 5:\n              console.log('Marks saved successfully for student:', student.name);\n              _this6.$store.dispatch('showToast', {\n                message: \"Marks saved for \".concat(student.name),\n                type: 'success'\n              });\n              _context5.n = 7;\n              break;\n            case 6:\n              _context5.p = 6;\n              _t4 = _context5.v;\n              console.error('Error saving student marks:', _t4);\n              _this6.$store.dispatch('showToast', {\n                message: \"Error saving marks for \".concat(student.name, \": \").concat(_t4.message),\n                type: 'error'\n              });\n              throw _t4;\n            case 7:\n              return _context5.a(2);\n          }\n        }, _callee5, null, [[0, 6]]);\n      }))();\n    },\n    saveAllMarks: function saveAllMarks() {\n      var _this7 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6() {\n        var _iterator, _step, student, _t5, _t6;\n        return _regenerator().w(function (_context6) {\n          while (1) switch (_context6.n) {\n            case 0:\n              if (_this7.unsavedChanges) {\n                _context6.n = 1;\n                break;\n              }\n              _this7.$store.dispatch('showToast', {\n                message: 'No changes to save',\n                type: 'info'\n              });\n              return _context6.a(2);\n            case 1:\n              _this7.isLoading = true;\n              _context6.p = 2;\n              // Save all student marks to API\n              _iterator = _createForOfIteratorHelper(_this7.students);\n              _context6.p = 3;\n              _iterator.s();\n            case 4:\n              if ((_step = _iterator.n()).done) {\n                _context6.n = 6;\n                break;\n              }\n              student = _step.value;\n              _context6.n = 5;\n              return _this7.saveStudentMarks(student);\n            case 5:\n              _context6.n = 4;\n              break;\n            case 6:\n              _context6.n = 8;\n              break;\n            case 7:\n              _context6.p = 7;\n              _t5 = _context6.v;\n              _iterator.e(_t5);\n            case 8:\n              _context6.p = 8;\n              _iterator.f();\n              return _context6.f(8);\n            case 9:\n              _this7.unsavedChanges = false;\n              _this7.$store.dispatch('showToast', {\n                message: 'All marks saved successfully',\n                type: 'success'\n              });\n              _context6.n = 11;\n              break;\n            case 10:\n              _context6.p = 10;\n              _t6 = _context6.v;\n              console.error('Error saving all marks:', _t6);\n              _this7.$store.dispatch('showToast', {\n                message: 'Error saving marks',\n                type: 'error'\n              });\n            case 11:\n              _context6.p = 11;\n              _this7.isLoading = false;\n              return _context6.f(11);\n            case 12:\n              return _context6.a(2);\n          }\n        }, _callee6, null, [[3, 7, 8, 9], [2, 10, 11, 12]]);\n      }))();\n    },\n    exportMarks: function exportMarks() {\n      var _this$course, _this$course2, _this$course3, _this$course4, _this$course5;\n      console.log('Client-side export started');\n      console.log('Students data:', this.students);\n      console.log('Course data:', this.course);\n      if (!this.students.length) {\n        this.$store.dispatch('showToast', {\n          message: 'No marks to export',\n          type: 'warning'\n        });\n        return;\n      }\n\n      // Helper function to escape CSV values\n      var escapeCSV = function escapeCSV(value) {\n        if (value === null || value === undefined) return '';\n        var stringValue = String(value);\n        if (stringValue.includes(',') || stringValue.includes('\"') || stringValue.includes('\\n')) {\n          return '\"' + stringValue.replace(/\"/g, '\"\"') + '\"';\n        }\n        return stringValue;\n      };\n\n      // Create CSV data with course info header\n      var courseInfo = [['Course Code', ((_this$course = this.course) === null || _this$course === void 0 ? void 0 : _this$course.code) || ''], ['Course Name', ((_this$course2 = this.course) === null || _this$course2 === void 0 ? void 0 : _this$course2.name) || ''], ['Academic Year', ((_this$course3 = this.course) === null || _this$course3 === void 0 ? void 0 : _this$course3.academic_year) || ''], ['Semester', ((_this$course4 = this.course) === null || _this$course4 === void 0 ? void 0 : _this$course4.semester) || ''], ['Export Date', new Date().toLocaleDateString()], ['Export Time', new Date().toLocaleTimeString()], [''] // Empty row for separation\n      ];\n\n      // Add headers for student marks\n      var headers = ['Student Name', 'Matric Number', 'Assignment (25%)', 'Quiz (20%)', 'Test (25%)', 'Final Exam (30%)', 'Final Mark', 'Letter Grade'];\n      var csvData = [].concat(courseInfo, [headers]);\n\n      // Add student data\n      this.students.forEach(function (student) {\n        var row = [escapeCSV(student.name), escapeCSV(student.matric_number || 'N/A'), student.marks.assignment || '', student.marks.quiz || '', student.marks.test || '', student.marks.final_exam || '', student.marks.final_mark ? student.marks.final_mark.toFixed(2) : '', escapeCSV(student.marks.grade || '')];\n        csvData.push(row);\n      });\n\n      // Add summary statistics\n      if (this.students.length > 0) {\n        var validFinalMarks = this.students.map(function (s) {\n          return s.marks.final_mark;\n        }).filter(function (mark) {\n          return mark !== null && mark !== undefined && !isNaN(mark);\n        });\n        if (validFinalMarks.length > 0) {\n          var average = validFinalMarks.reduce(function (sum, mark) {\n            return sum + mark;\n          }, 0) / validFinalMarks.length;\n          var highest = Math.max.apply(Math, _toConsumableArray(validFinalMarks));\n          var lowest = Math.min.apply(Math, _toConsumableArray(validFinalMarks));\n          csvData.push([''],\n          // Empty row\n          ['SUMMARY STATISTICS'], ['Number of Students', this.students.length], ['Students with Marks', validFinalMarks.length], ['Class Average', average.toFixed(2)], ['Highest Mark', highest.toFixed(2)], ['Lowest Mark', lowest.toFixed(2)]);\n        }\n      }\n\n      // Convert to CSV string\n      var csvString = csvData.map(function (row) {\n        return row.join(',');\n      }).join('\\n');\n\n      // Download CSV\n      var blob = new Blob([csvString], {\n        type: 'text/csv;charset=utf-8'\n      });\n      var url = window.URL.createObjectURL(blob);\n      var a = document.createElement('a');\n      a.href = url;\n      var filename = \"\".concat(((_this$course5 = this.course) === null || _this$course5 === void 0 ? void 0 : _this$course5.code) || 'Course', \"_Marks_\").concat(new Date().toISOString().split('T')[0], \".csv\");\n      a.download = filename;\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      window.URL.revokeObjectURL(url);\n      this.$store.dispatch('showToast', {\n        message: \"Marks exported successfully as \".concat(filename),\n        type: 'success'\n      });\n    },\n    exportMarksServer: function exportMarksServer() {\n      var _this8 = this;\n      return _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7() {\n        var _this8$course, exportUrl, response, contentType, errorText, contentDisposition, filename, filenameMatch, blob, url, a, _t7;\n        return _regenerator().w(function (_context7) {\n          while (1) switch (_context7.n) {\n            case 0:\n              if (_this8.courseId) {\n                _context7.n = 1;\n                break;\n              }\n              _this8.$store.dispatch('showToast', {\n                message: 'Please select a course first',\n                type: 'warning'\n              });\n              return _context7.a(2);\n            case 1:\n              if (_this8.userId) {\n                _context7.n = 2;\n                break;\n              }\n              _this8.$store.dispatch('showToast', {\n                message: 'User authentication required',\n                type: 'error'\n              });\n              return _context7.a(2);\n            case 2:\n              _context7.p = 2;\n              _this8.$store.dispatch('setLoading', true);\n\n              // Create URL for server-side CSV export\n              exportUrl = \"http://localhost/marks-api.php?action=export_marks_csv&course_id=\".concat(_this8.courseId, \"&lecturer_id=\").concat(_this8.userId);\n              console.log('Exporting from URL:', exportUrl);\n\n              // Fetch the CSV data\n              _context7.n = 3;\n              return fetch(exportUrl, {\n                method: 'GET',\n                credentials: 'include',\n                headers: {\n                  'Accept': 'text/csv'\n                }\n              });\n            case 3:\n              response = _context7.v;\n              console.log('Export response:', response.status, response.statusText);\n              if (response.ok) {\n                _context7.n = 4;\n                break;\n              }\n              throw new Error(\"HTTP error! status: \".concat(response.status));\n            case 4:\n              // Check if response is actually CSV\n              contentType = response.headers.get('content-type');\n              if (!(!contentType || !contentType.includes('text/csv'))) {\n                _context7.n = 6;\n                break;\n              }\n              _context7.n = 5;\n              return response.text();\n            case 5:\n              errorText = _context7.v;\n              throw new Error('Server did not return CSV data: ' + errorText);\n            case 6:\n              // Get the filename from Content-Disposition header\n              contentDisposition = response.headers.get('content-disposition');\n              filename = \"\".concat(((_this8$course = _this8.course) === null || _this8$course === void 0 ? void 0 : _this8$course.code) || 'Course', \"_Marks_\").concat(new Date().toISOString().split('T')[0], \".csv\");\n              if (contentDisposition) {\n                filenameMatch = contentDisposition.match(/filename=\"(.+)\"/);\n                if (filenameMatch) {\n                  filename = filenameMatch[1];\n                }\n              }\n\n              // Create blob and download\n              _context7.n = 7;\n              return response.blob();\n            case 7:\n              blob = _context7.v;\n              url = window.URL.createObjectURL(blob);\n              a = document.createElement('a');\n              a.href = url;\n              a.download = filename;\n              a.style.display = 'none';\n              document.body.appendChild(a);\n              a.click();\n              document.body.removeChild(a);\n              window.URL.revokeObjectURL(url);\n              _this8.$store.dispatch('showToast', {\n                message: \"Detailed marks exported successfully as \".concat(filename),\n                type: 'success'\n              });\n              _context7.n = 9;\n              break;\n            case 8:\n              _context7.p = 8;\n              _t7 = _context7.v;\n              console.error('Error exporting marks:', _t7);\n              _this8.$store.dispatch('showToast', {\n                message: 'Error exporting marks: ' + _t7.message,\n                type: 'error'\n              });\n            case 9:\n              _context7.p = 9;\n              _this8.$store.dispatch('setLoading', false);\n              return _context7.f(9);\n            case 10:\n              return _context7.a(2);\n          }\n        }, _callee7, null, [[2, 8, 9, 10]]);\n      }))();\n    },\n    showMarkingGuide: function showMarkingGuide() {\n      var modal = new bootstrap.Modal(document.getElementById('markingGuideModal'));\n      modal.show();\n    },\n    viewStudentDetails: function viewStudentDetails(student) {\n      this.$router.push(\"/lecturer/student/\".concat(student.id));\n    },\n    getStudentInitials: function getStudentInitials(name) {\n      return name.split(' ').map(function (n) {\n        return n.charAt(0);\n      }).join('').toUpperCase();\n    },\n    getGradeBadgeClass: function getGradeBadgeClass(grade) {\n      var gradeClasses = {\n        'A': 'bg-success',\n        'B': 'bg-info',\n        'C': 'bg-warning text-dark',\n        'D': 'bg-secondary',\n        'F': 'bg-danger'\n      };\n      return gradeClasses[grade] || 'bg-light text-dark';\n    }\n  }\n};","map":{"version":3,"names":["mapGetters","bootstrap","name","data","courseId","$route","params","course","students","lecturerCourses","isLoading","unsavedChanges","computed","_objectSpread","currentUser","getUser","created","_this","_asyncToGenerator","_regenerator","m","_callee","w","_context","n","console","log","user","userId","isAuthenticated","$store","getters","$nextTick","loadLecturerCourses","loadCourseData","a","methods","_this2","_callee2","lecturerId","response","_t","_context2","p","Error","fetch","concat","method","credentials","headers","v","status","ok","json","error","courses","dispatch","message","type","_this3","_callee3","_t2","_context3","find","c","id","loadStudentsWithMarks","f","_this4","_callee4","_t3","_context4","map","student","student_id","student_name","email","matric_number","marks","assignment","assignment_mark","quiz","quiz_mark","test","test_mark","final_exam","final_exam_mark","final_mark","final_grade","grade","letter_grade","forEach","calculateFinalMark","finalExam","componentMark","finalMark","calculateGrade","calculateAllFinalMarks","_this5","saveStudentMarks","_this6","_callee5","requestData","_t4","_context5","action","course_id","lecturer_id","body","JSON","stringify","saveAllMarks","_this7","_callee6","_iterator","_step","_t5","_t6","_context6","_createForOfIteratorHelper","s","done","value","e","exportMarks","_this$course","_this$course2","_this$course3","_this$course4","_this$course5","length","escapeCSV","undefined","stringValue","String","includes","replace","courseInfo","code","academic_year","semester","Date","toLocaleDateString","toLocaleTimeString","csvData","row","toFixed","push","validFinalMarks","filter","mark","isNaN","average","reduce","sum","highest","Math","max","apply","_toConsumableArray","lowest","min","csvString","join","blob","Blob","url","window","URL","createObjectURL","document","createElement","href","filename","toISOString","split","download","appendChild","click","removeChild","revokeObjectURL","exportMarksServer","_this8","_callee7","_this8$course","exportUrl","contentType","errorText","contentDisposition","filenameMatch","_t7","_context7","statusText","get","text","match","style","display","showMarkingGuide","modal","Modal","getElementById","show","viewStudentDetails","$router","getStudentInitials","charAt","toUpperCase","getGradeBadgeClass","gradeClasses"],"sources":["C:\\Users\\ansmu\\Desktop\\Web\\course-mark-management\\frontend\\src\\views\\lecturer\\MarksManagement.vue"],"sourcesContent":["<template>\r\n  <div class=\"marks-management\">\r\n    <!-- Header -->\r\n    <div class=\"d-flex justify-content-between align-items-center mb-4\">\r\n      <div>\r\n        <nav aria-label=\"breadcrumb\">\r\n          <ol class=\"breadcrumb\">\r\n            <li class=\"breadcrumb-item\">\r\n              <router-link to=\"/lecturer/dashboard\">Dashboard</router-link>\r\n            </li>\r\n            <li class=\"breadcrumb-item\">\r\n              <router-link :to=\"`/lecturer/course/${courseId}`\">{{ course?.code }}</router-link>\r\n            </li>\r\n            <li class=\"breadcrumb-item active\" aria-current=\"page\">Marks Management</li>\r\n          </ol>\r\n        </nav>\r\n        <h1 class=\"mb-2\">Marks Management</h1>\r\n        <p class=\"text-muted\">\r\n          {{ course?.code }} - {{ course?.name }} | {{ course?.semester }}\r\n        </p>\r\n      </div>\r\n      <div class=\"btn-group\">\r\n        <button class=\"btn btn-success\" @click=\"saveAllMarks\" :disabled=\"isLoading\">\r\n          <i class=\"fas fa-save me-2\"></i>Save All Changes\r\n        </button>\r\n        <div class=\"btn-group\" role=\"group\">\r\n          <button type=\"button\" class=\"btn btn-outline-primary dropdown-toggle\" data-bs-toggle=\"dropdown\" aria-expanded=\"false\">\r\n            <i class=\"fas fa-file-export me-2\"></i>Export Marks\r\n          </button>\r\n          <ul class=\"dropdown-menu\">\r\n            <li><a class=\"dropdown-item\" href=\"#\" @click.prevent=\"exportMarks\" title=\"Quick client-side export with basic student marks\">\r\n              <i class=\"fas fa-download me-2\"></i>Quick Export (Client-side)\r\n              <br><small class=\"text-muted\">Basic marks data, processed in browser</small>\r\n            </a></li>\r\n            <li><hr class=\"dropdown-divider\"></li>\r\n            <li><a class=\"dropdown-item\" href=\"#\" @click.prevent=\"exportMarksServer\" title=\"Comprehensive server-side export with detailed statistics\">\r\n              <i class=\"fas fa-server me-2\"></i>Detailed Export (Server-side)\r\n              <br><small class=\"text-muted\">Full marks data with statistics and proper formatting</small>\r\n            </a></li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Course Selection -->\r\n    <div class=\"card mb-4\">\r\n      <div class=\"card-body\">\r\n        <div class=\"row\">\r\n          <div class=\"col-md-6\">\r\n            <label for=\"courseSelect\" class=\"form-label\">Select Course:</label>\r\n            <select \r\n              id=\"courseSelect\" \r\n              v-model=\"courseId\" \r\n              @change=\"loadCourseData\"\r\n              class=\"form-select\"\r\n            >\r\n              <option value=\"\">Select a course...</option>\r\n              <option \r\n                v-for=\"course in lecturerCourses\" \r\n                :key=\"course.id\" \r\n                :value=\"course.id\"\r\n              >\r\n                {{ course.code }} - {{ course.name }}\r\n              </option>\r\n            </select>\r\n          </div>\r\n          <div class=\"col-md-6\">\r\n            <label class=\"form-label\">Assessment Breakdown:</label>\r\n            <div class=\"d-flex gap-3\">\r\n              <div class=\"badge bg-primary p-2\">\r\n                <i class=\"fas fa-tasks me-2\"></i>Components: 70%\r\n              </div>\r\n              <div class=\"badge bg-warning p-2\">\r\n                <i class=\"fas fa-graduation-cap me-2\"></i>Final Exam: 30%\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <div v-if=\"isLoading\" class=\"text-center my-5\">\r\n      <div class=\"spinner-border text-primary\" role=\"status\">\r\n        <span class=\"visually-hidden\">Loading...</span>\r\n      </div>\r\n    </div>\r\n\r\n    <div v-else-if=\"!courseId\" class=\"text-center my-5\">\r\n      <i class=\"fas fa-book-open text-muted mb-3\" style=\"font-size: 3rem;\"></i>\r\n      <h5 class=\"text-muted\">Select a Course</h5>\r\n      <p class=\"text-muted\">Choose a course from the dropdown above to manage student marks.</p>\r\n    </div>\r\n\r\n    <div v-else-if=\"students.length === 0\" class=\"text-center my-5\">\r\n      <i class=\"fas fa-users text-muted mb-3\" style=\"font-size: 3rem;\"></i>\r\n      <h5 class=\"text-muted\">No Students Enrolled</h5>\r\n      <p class=\"text-muted\">There are no students enrolled in this course yet.</p>\r\n    </div>\r\n\r\n    <!-- Marks Table -->\r\n    <div v-else class=\"card\">\r\n      <div class=\"card-header bg-light\">\r\n        <div class=\"d-flex justify-content-between align-items-center\">\r\n          <h5 class=\"mb-0\">Student Marks</h5>\r\n          <div class=\"d-flex gap-2\">\r\n            <button class=\"btn btn-sm btn-outline-success\" @click=\"calculateAllFinalMarks\">\r\n              <i class=\"fas fa-calculator me-2\"></i>Calculate Final Marks\r\n            </button>\r\n            <button class=\"btn btn-sm btn-outline-info\" @click=\"showMarkingGuide\">\r\n              <i class=\"fas fa-info-circle me-2\"></i>Marking Guide\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"card-body p-0\">\r\n        <div class=\"table-responsive\">\r\n          <table class=\"table table-hover mb-0\">\r\n            <thead class=\"table-light\">\r\n              <tr>\r\n                <th rowspan=\"2\" class=\"align-middle\">Student</th>\r\n                <th rowspan=\"2\" class=\"align-middle\">Matric No.</th>\r\n                <th colspan=\"3\" class=\"text-center bg-primary text-white\">Components (70%)</th>\r\n                <th rowspan=\"2\" class=\"align-middle bg-warning text-dark\">Final Exam (30%)</th>\r\n                <th rowspan=\"2\" class=\"align-middle bg-success text-white\">Final Mark</th>\r\n                <th rowspan=\"2\" class=\"align-middle\">Grade</th>\r\n                <th rowspan=\"2\" class=\"align-middle\">Actions</th>\r\n              </tr>\r\n              <tr>\r\n                <th class=\"bg-primary text-white\">Assignment</th>\r\n                <th class=\"bg-primary text-white\">Quiz</th>\r\n                <th class=\"bg-primary text-white\">Test</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              <tr v-for=\"student in students\" :key=\"student.id\">\r\n                <td>\r\n                  <div class=\"d-flex align-items-center\">\r\n                    <div class=\"avatar avatar-sm me-3\">\r\n                      {{ getStudentInitials(student.name) }}\r\n                    </div>\r\n                    <div>\r\n                      <strong>{{ student.name }}</strong>\r\n                      <br>\r\n                      <small class=\"text-muted\">{{ student.email }}</small>\r\n                    </div>\r\n                  </div>\r\n                </td>\r\n                <td>{{ student.matric_number || 'N/A' }}</td>\r\n                \r\n                <!-- Component Marks (70%) -->\r\n                <td>\r\n                  <input \r\n                    type=\"number\" \r\n                    class=\"form-control form-control-sm\"\r\n                    v-model.number=\"student.marks.assignment\"\r\n                    @input=\"calculateFinalMark(student)\"\r\n                    min=\"0\" \r\n                    max=\"100\"\r\n                    placeholder=\"0-100\"\r\n                  >\r\n                </td>\r\n                <td>\r\n                  <input \r\n                    type=\"number\" \r\n                    class=\"form-control form-control-sm\"\r\n                    v-model.number=\"student.marks.quiz\"\r\n                    @input=\"calculateFinalMark(student)\"\r\n                    min=\"0\" \r\n                    max=\"100\"\r\n                    placeholder=\"0-100\"\r\n                  >\r\n                </td>\r\n                <td>\r\n                  <input \r\n                    type=\"number\" \r\n                    class=\"form-control form-control-sm\"\r\n                    v-model.number=\"student.marks.test\"\r\n                    @input=\"calculateFinalMark(student)\"\r\n                    min=\"0\" \r\n                    max=\"100\"\r\n                    placeholder=\"0-100\"\r\n                  >\r\n                </td>\r\n                \r\n                <!-- Final Exam (30%) -->\r\n                <td>\r\n                  <input \r\n                    type=\"number\" \r\n                    class=\"form-control form-control-sm\"\r\n                    v-model.number=\"student.marks.final_exam\"\r\n                    @input=\"calculateFinalMark(student)\"\r\n                    min=\"0\" \r\n                    max=\"100\"\r\n                    placeholder=\"0-100\"\r\n                  >\r\n                </td>\r\n                \r\n                <!-- Final Mark -->\r\n                <td>\r\n                  <span class=\"badge bg-success fs-6\">\r\n                    {{ student.marks.final_mark ? student.marks.final_mark.toFixed(1) : 'N/A' }}\r\n                  </span>\r\n                </td>\r\n                \r\n                <!-- Grade -->\r\n                <td>\r\n                  <span class=\"badge\" :class=\"getGradeBadgeClass(student.marks.grade)\">\r\n                    {{ student.marks.grade || 'N/A' }}\r\n                  </span>\r\n                </td>\r\n                \r\n                <!-- Actions -->\r\n                <td>\r\n                  <div class=\"btn-group btn-group-sm\">\r\n                    <button \r\n                      class=\"btn btn-outline-primary\"\r\n                      @click=\"viewStudentDetails(student)\"\r\n                      title=\"View Details\"\r\n                    >\r\n                      <i class=\"fas fa-eye\"></i>\r\n                    </button>\r\n                    <button \r\n                      class=\"btn btn-outline-success\"\r\n                      @click=\"saveStudentMarks(student)\"\r\n                      title=\"Save Marks\"\r\n                    >\r\n                      <i class=\"fas fa-save\"></i>\r\n                    </button>\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Marking Guide Modal -->\r\n    <div class=\"modal fade\" id=\"markingGuideModal\" tabindex=\"-1\" aria-labelledby=\"markingGuideModalLabel\" aria-hidden=\"true\">\r\n      <div class=\"modal-dialog modal-lg\">\r\n        <div class=\"modal-content\">\r\n          <div class=\"modal-header\">\r\n            <h5 class=\"modal-title\" id=\"markingGuideModalLabel\">Marking Guide</h5>\r\n            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Close\"></button>\r\n          </div>\r\n          <div class=\"modal-body\">\r\n            <div class=\"row\">\r\n              <div class=\"col-md-6\">\r\n                <h6>Assessment Breakdown</h6>\r\n                <ul class=\"list-group list-group-flush\">\r\n                  <li class=\"list-group-item d-flex justify-content-between\">\r\n                    <span>Assignment</span>\r\n                    <span class=\"badge bg-primary\">25%</span>\r\n                  </li>\r\n                  <li class=\"list-group-item d-flex justify-content-between\">\r\n                    <span>Quiz</span>\r\n                    <span class=\"badge bg-primary\">20%</span>\r\n                  </li>\r\n                  <li class=\"list-group-item d-flex justify-content-between\">\r\n                    <span>Test</span>\r\n                    <span class=\"badge bg-primary\">25%</span>\r\n                  </li>\r\n                  <li class=\"list-group-item d-flex justify-content-between\">\r\n                    <span><strong>Components Total</strong></span>\r\n                    <span class=\"badge bg-primary\"><strong>70%</strong></span>\r\n                  </li>\r\n                  <li class=\"list-group-item d-flex justify-content-between\">\r\n                    <span><strong>Final Exam</strong></span>\r\n                    <span class=\"badge bg-warning text-dark\"><strong>30%</strong></span>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n              <div class=\"col-md-6\">\r\n                <h6>Grading Scale</h6>\r\n                <ul class=\"list-group list-group-flush\">\r\n                  <li class=\"list-group-item d-flex justify-content-between\">\r\n                    <span>A</span>\r\n                    <span>80-100</span>\r\n                  </li>\r\n                  <li class=\"list-group-item d-flex justify-content-between\">\r\n                    <span>B</span>\r\n                    <span>70-79</span>\r\n                  </li>\r\n                  <li class=\"list-group-item d-flex justify-content-between\">\r\n                    <span>C</span>\r\n                    <span>60-69</span>\r\n                  </li>\r\n                  <li class=\"list-group-item d-flex justify-content-between\">\r\n                    <span>D</span>\r\n                    <span>50-59</span>\r\n                  </li>\r\n                  <li class=\"list-group-item d-flex justify-content-between\">\r\n                    <span>F</span>\r\n                    <span>0-49</span>\r\n                  </li>\r\n                </ul>\r\n              </div>\r\n            </div>\r\n            <div class=\"mt-3\">\r\n              <h6>Calculation Formula</h6>\r\n              <div class=\"alert alert-info\">\r\n                <strong>Final Grade = (Assignment × 25%) + (Quiz × 20%) + (Test × 25%) + (Final Exam × 30%)</strong>\r\n                <br><small class=\"text-muted\">Components (Assignment + Quiz + Test) contribute 70% total, Final Exam contributes 30%</small>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div class=\"modal-footer\">\r\n            <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Close</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { mapGetters } from 'vuex';\r\nimport * as bootstrap from 'bootstrap';\r\n\r\nexport default {\r\n  name: 'MarksManagement',\r\n  data() {\r\n    return {\r\n      courseId: this.$route.params.courseId || '',\r\n      course: null,\r\n      students: [],\r\n      lecturerCourses: [],\r\n      isLoading: false,\r\n      unsavedChanges: false\r\n    };\r\n  },\r\n  computed: {\r\n    ...mapGetters('auth', ['getUser', 'userId']),\r\n    currentUser() {\r\n      return this.getUser;\r\n    }\r\n  },\r\n  async created() {\r\n    console.log('MarksManagement component created');\r\n    console.log('Initial auth state:', {\r\n      user: this.getUser,\r\n      userId: this.userId,\r\n      isAuthenticated: this.$store.getters['auth/isAuthenticated']\r\n    });\r\n    \r\n    // Wait a bit for auth to be initialized if needed\r\n    await this.$nextTick();\r\n    \r\n    await this.loadLecturerCourses();\r\n    if (this.courseId) {\r\n      await this.loadCourseData();\r\n    }\r\n  },\r\n  methods: {\r\n    async loadLecturerCourses() {\r\n      try {\r\n        console.log('Loading lecturer courses...');\r\n        console.log('User ID:', this.userId);\r\n        console.log('Current user:', this.currentUser);\r\n        \r\n        if (!this.userId) {\r\n          throw new Error('User not authenticated');\r\n        }\r\n        \r\n        const lecturerId = this.userId;\r\n        \r\n        const response = await fetch(`http://localhost/marks-api.php?action=lecturer_courses&lecturer_id=${lecturerId}`, {\r\n          method: 'GET',\r\n          credentials: 'include',\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          }\r\n        });\r\n\r\n        console.log('API Response status:', response.status);\r\n\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        console.log('API Response data:', data);\r\n        \r\n        if (data.error) {\r\n          throw new Error(data.error);\r\n        }\r\n\r\n        this.lecturerCourses = data.courses || [];\r\n        console.log('Loaded lecturer courses:', this.lecturerCourses);\r\n\r\n      } catch (error) {\r\n        console.error('Error loading lecturer courses:', error);\r\n        this.$store.dispatch('showToast', {\r\n          message: 'Error loading courses: ' + error.message,\r\n          type: 'error'\r\n        });\r\n        this.lecturerCourses = [];\r\n      }\r\n    },\r\n\r\n    async loadCourseData() {\r\n      if (!this.courseId) return;\r\n      \r\n      this.isLoading = true;\r\n      try {\r\n        // Find the selected course\r\n        this.course = this.lecturerCourses.find(c => c.id == this.courseId);\r\n        \r\n        // Load students for this course with their marks\r\n        await this.loadStudentsWithMarks();\r\n        \r\n      } catch (error) {\r\n        console.error('Error loading course data:', error);\r\n        this.$store.dispatch('showToast', {\r\n          message: 'Error loading course data',\r\n          type: 'error'\r\n        });\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n\r\n    async loadStudentsWithMarks() {\r\n      try {\r\n        // Make API call to get students with marks for this course\r\n        const response = await fetch(`http://localhost/marks-api.php?action=course_students_marks&course_id=${this.courseId}`, {\r\n          method: 'GET',\r\n          credentials: 'include',\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          }\r\n        });\r\n\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        \r\n        if (data.error) {\r\n          throw new Error(data.error);\r\n        }\r\n\r\n        // Map the API response to the expected format\r\n        this.students = data.students.map(student => ({\r\n          id: student.student_id,\r\n          name: student.student_name,\r\n          email: student.email || 'N/A',\r\n          matric_number: student.matric_number,\r\n          marks: {\r\n            assignment: student.assignment_mark || 0,\r\n            quiz: student.quiz_mark || 0,\r\n            test: student.test_mark || 0,\r\n            final_exam: student.final_exam_mark || 0,\r\n            final_mark: student.final_grade || 0,\r\n            grade: student.letter_grade || 'F'\r\n          }\r\n        }));\r\n\r\n        // Calculate final marks for all students to ensure they're up to date\r\n        this.students.forEach(student => {\r\n          this.calculateFinalMark(student);\r\n        });\r\n\r\n        console.log('Loaded students with marks:', this.students);\r\n\r\n      } catch (error) {\r\n        console.error('Error loading students with marks:', error);\r\n        this.$store.dispatch('showToast', {\r\n          message: 'Error loading student marks: ' + error.message,\r\n          type: 'error'\r\n        });\r\n        \r\n        // Fallback to empty array\r\n        this.students = [];\r\n      }\r\n    },\r\n\r\n    calculateFinalMark(student) {\r\n      const marks = student.marks;\r\n      \r\n      // Check if all marks are entered\r\n      const assignment = marks.assignment || 0;\r\n      const quiz = marks.quiz || 0;\r\n      const test = marks.test || 0;\r\n      const finalExam = marks.final_exam || 0;\r\n      \r\n      // Calculate final mark: Components (70%) + Final Exam (30%)\r\n      // Components breakdown: Assignment (25%) + Quiz (20%) + Test (25%)\r\n      const componentMark = (assignment * 0.25) + (quiz * 0.20) + (test * 0.25);\r\n      const finalMark = componentMark + (finalExam * 0.30);\r\n      \r\n      marks.final_mark = finalMark;\r\n      marks.grade = this.calculateGrade(finalMark);\r\n      \r\n      this.unsavedChanges = true;\r\n    },\r\n\r\n    calculateGrade(finalMark) {\r\n      if (finalMark >= 80) return 'A';\r\n      if (finalMark >= 70) return 'B';\r\n      if (finalMark >= 60) return 'C';\r\n      if (finalMark >= 50) return 'D';\r\n      return 'F';\r\n    },\r\n\r\n    calculateAllFinalMarks() {\r\n      this.students.forEach(student => {\r\n        this.calculateFinalMark(student);\r\n      });\r\n      \r\n      this.$store.dispatch('showToast', {\r\n        message: 'Final marks calculated for all students',\r\n        type: 'success'\r\n      });\r\n    },\r\n\r\n    async saveStudentMarks(student) {\r\n      try {\r\n        if (!this.userId) {\r\n          throw new Error('User not authenticated');\r\n        }\r\n        \r\n        const lecturerId = this.userId;\r\n        \r\n        const requestData = {\r\n          action: 'save_marks',\r\n          student_id: student.id,\r\n          course_id: this.courseId,\r\n          lecturer_id: lecturerId,\r\n          marks: {\r\n            assignment: student.marks.assignment || 0,\r\n            quiz: student.marks.quiz || 0,\r\n            test: student.marks.test || 0,\r\n            final_exam: student.marks.final_exam || 0\r\n          }\r\n        };\r\n\r\n        const response = await fetch('http://localhost/marks-api.php', {\r\n          method: 'POST',\r\n          credentials: 'include',\r\n          headers: {\r\n            'Content-Type': 'application/json'\r\n          },\r\n          body: JSON.stringify(requestData)\r\n        });\r\n\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        \r\n        if (data.error) {\r\n          throw new Error(data.error);\r\n        }\r\n\r\n        console.log('Marks saved successfully for student:', student.name);\r\n        \r\n        this.$store.dispatch('showToast', {\r\n          message: `Marks saved for ${student.name}`,\r\n          type: 'success'\r\n        });\r\n\r\n      } catch (error) {\r\n        console.error('Error saving student marks:', error);\r\n        this.$store.dispatch('showToast', {\r\n          message: `Error saving marks for ${student.name}: ${error.message}`,\r\n          type: 'error'\r\n        });\r\n        throw error; // Re-throw so saveAllMarks can handle it\r\n      }\r\n    },\r\n\r\n    async saveAllMarks() {\r\n      if (!this.unsavedChanges) {\r\n        this.$store.dispatch('showToast', {\r\n          message: 'No changes to save',\r\n          type: 'info'\r\n        });\r\n        return;\r\n      }\r\n\r\n      this.isLoading = true;\r\n      try {\r\n        // Save all student marks to API\r\n        for (const student of this.students) {\r\n          await this.saveStudentMarks(student);\r\n        }\r\n        \r\n        this.unsavedChanges = false;\r\n        this.$store.dispatch('showToast', {\r\n          message: 'All marks saved successfully',\r\n          type: 'success'\r\n        });\r\n      } catch (error) {\r\n        console.error('Error saving all marks:', error);\r\n        this.$store.dispatch('showToast', {\r\n          message: 'Error saving marks',\r\n          type: 'error'\r\n        });\r\n      } finally {\r\n        this.isLoading = false;\r\n      }\r\n    },\r\n\r\n    exportMarks() {\r\n      console.log('Client-side export started');\r\n      console.log('Students data:', this.students);\r\n      console.log('Course data:', this.course);\r\n      \r\n      if (!this.students.length) {\r\n        this.$store.dispatch('showToast', {\r\n          message: 'No marks to export',\r\n          type: 'warning'\r\n        });\r\n        return;\r\n      }\r\n\r\n      // Helper function to escape CSV values\r\n      const escapeCSV = (value) => {\r\n        if (value === null || value === undefined) return '';\r\n        const stringValue = String(value);\r\n        if (stringValue.includes(',') || stringValue.includes('\"') || stringValue.includes('\\n')) {\r\n          return '\"' + stringValue.replace(/\"/g, '\"\"') + '\"';\r\n        }\r\n        return stringValue;\r\n      };\r\n\r\n      // Create CSV data with course info header\r\n      const courseInfo = [\r\n        ['Course Code', this.course?.code || ''],\r\n        ['Course Name', this.course?.name || ''],\r\n        ['Academic Year', this.course?.academic_year || ''],\r\n        ['Semester', this.course?.semester || ''],\r\n        ['Export Date', new Date().toLocaleDateString()],\r\n        ['Export Time', new Date().toLocaleTimeString()],\r\n        [''], // Empty row for separation\r\n      ];\r\n\r\n      // Add headers for student marks\r\n      const headers = ['Student Name', 'Matric Number', 'Assignment (25%)', 'Quiz (20%)', 'Test (25%)', 'Final Exam (30%)', 'Final Mark', 'Letter Grade'];\r\n      \r\n      const csvData = [...courseInfo, headers];\r\n      \r\n      // Add student data\r\n      this.students.forEach(student => {\r\n        const row = [\r\n          escapeCSV(student.name),\r\n          escapeCSV(student.matric_number || 'N/A'),\r\n          student.marks.assignment || '',\r\n          student.marks.quiz || '',\r\n          student.marks.test || '',\r\n          student.marks.final_exam || '',\r\n          student.marks.final_mark ? student.marks.final_mark.toFixed(2) : '',\r\n          escapeCSV(student.marks.grade || '')\r\n        ];\r\n        csvData.push(row);\r\n      });\r\n\r\n      // Add summary statistics\r\n      if (this.students.length > 0) {\r\n        const validFinalMarks = this.students\r\n          .map(s => s.marks.final_mark)\r\n          .filter(mark => mark !== null && mark !== undefined && !isNaN(mark));\r\n        \r\n        if (validFinalMarks.length > 0) {\r\n          const average = validFinalMarks.reduce((sum, mark) => sum + mark, 0) / validFinalMarks.length;\r\n          const highest = Math.max(...validFinalMarks);\r\n          const lowest = Math.min(...validFinalMarks);\r\n          \r\n          csvData.push(\r\n            [''], // Empty row\r\n            ['SUMMARY STATISTICS'],\r\n            ['Number of Students', this.students.length],\r\n            ['Students with Marks', validFinalMarks.length],\r\n            ['Class Average', average.toFixed(2)],\r\n            ['Highest Mark', highest.toFixed(2)],\r\n            ['Lowest Mark', lowest.toFixed(2)]\r\n          );\r\n        }\r\n      }\r\n\r\n      // Convert to CSV string\r\n      const csvString = csvData.map(row => row.join(',')).join('\\n');\r\n      \r\n      // Download CSV\r\n      const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8' });\r\n      const url = window.URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      const filename = `${this.course?.code || 'Course'}_Marks_${new Date().toISOString().split('T')[0]}.csv`;\r\n      a.download = filename;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      document.body.removeChild(a);\r\n      window.URL.revokeObjectURL(url);\r\n      \r\n      this.$store.dispatch('showToast', {\r\n        message: `Marks exported successfully as ${filename}`,\r\n        type: 'success'\r\n      });\r\n    },\r\n\r\n    async exportMarksServer() {\r\n      if (!this.courseId) {\r\n        this.$store.dispatch('showToast', {\r\n          message: 'Please select a course first',\r\n          type: 'warning'\r\n        });\r\n        return;\r\n      }\r\n\r\n      if (!this.userId) {\r\n        this.$store.dispatch('showToast', {\r\n          message: 'User authentication required',\r\n          type: 'error'\r\n        });\r\n        return;\r\n      }\r\n\r\n      try {\r\n        this.$store.dispatch('setLoading', true);\r\n        \r\n        // Create URL for server-side CSV export\r\n        const exportUrl = `http://localhost/marks-api.php?action=export_marks_csv&course_id=${this.courseId}&lecturer_id=${this.userId}`;\r\n        \r\n        console.log('Exporting from URL:', exportUrl);\r\n        \r\n        // Fetch the CSV data\r\n        const response = await fetch(exportUrl, {\r\n          method: 'GET',\r\n          credentials: 'include',\r\n          headers: {\r\n            'Accept': 'text/csv'\r\n          }\r\n        });\r\n\r\n        console.log('Export response:', response.status, response.statusText);\r\n\r\n        if (!response.ok) {\r\n          throw new Error(`HTTP error! status: ${response.status}`);\r\n        }\r\n\r\n        // Check if response is actually CSV\r\n        const contentType = response.headers.get('content-type');\r\n        if (!contentType || !contentType.includes('text/csv')) {\r\n          const errorText = await response.text();\r\n          throw new Error('Server did not return CSV data: ' + errorText);\r\n        }\r\n\r\n        // Get the filename from Content-Disposition header\r\n        const contentDisposition = response.headers.get('content-disposition');\r\n        let filename = `${this.course?.code || 'Course'}_Marks_${new Date().toISOString().split('T')[0]}.csv`;\r\n        \r\n        if (contentDisposition) {\r\n          const filenameMatch = contentDisposition.match(/filename=\"(.+)\"/);\r\n          if (filenameMatch) {\r\n            filename = filenameMatch[1];\r\n          }\r\n        }\r\n\r\n        // Create blob and download\r\n        const blob = await response.blob();\r\n        const url = window.URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = filename;\r\n        a.style.display = 'none';\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        document.body.removeChild(a);\r\n        window.URL.revokeObjectURL(url);\r\n        \r\n        this.$store.dispatch('showToast', {\r\n          message: `Detailed marks exported successfully as ${filename}`,\r\n          type: 'success'\r\n        });\r\n      } catch (error) {\r\n        console.error('Error exporting marks:', error);\r\n        this.$store.dispatch('showToast', {\r\n          message: 'Error exporting marks: ' + error.message,\r\n          type: 'error'\r\n        });\r\n      } finally {\r\n        this.$store.dispatch('setLoading', false);\r\n      }\r\n    },\r\n\r\n    showMarkingGuide() {\r\n      const modal = new bootstrap.Modal(document.getElementById('markingGuideModal'));\r\n      modal.show();\r\n    },\r\n\r\n    viewStudentDetails(student) {\r\n      this.$router.push(`/lecturer/student/${student.id}`);\r\n    },\r\n\r\n    getStudentInitials(name) {\r\n      return name.split(' ').map(n => n.charAt(0)).join('').toUpperCase();\r\n    },\r\n\r\n    getGradeBadgeClass(grade) {\r\n      const gradeClasses = {\r\n        'A': 'bg-success',\r\n        'B': 'bg-info',\r\n        'C': 'bg-warning text-dark',\r\n        'D': 'bg-secondary',\r\n        'F': 'bg-danger'\r\n      };\r\n      return gradeClasses[grade] || 'bg-light text-dark';\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.marks-management h1 {\r\n  color: #2c3e50;\r\n  font-weight: 700;\r\n}\r\n\r\n.avatar {\r\n  width: 40px;\r\n  height: 40px;\r\n  background: linear-gradient(45deg, #007bff, #0056b3);\r\n  border-radius: 50%;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  color: white;\r\n  font-weight: bold;\r\n  font-size: 0.9rem;\r\n}\r\n\r\n.table input.form-control-sm {\r\n  width: 80px;\r\n  text-align: center;\r\n}\r\n\r\n.table th {\r\n  font-weight: 600;\r\n  border-top: none;\r\n}\r\n\r\n.table td {\r\n  vertical-align: middle;\r\n}\r\n\r\n.card {\r\n  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\r\n  border: none;\r\n  border-radius: 10px;\r\n}\r\n\r\n.breadcrumb-item a {\r\n  text-decoration: none;\r\n  color: #007bff;\r\n}\r\n\r\n.breadcrumb-item a:hover {\r\n  color: #0056b3;\r\n}\r\n\r\n.badge.fs-6 {\r\n  font-size: 0.9rem !important;\r\n}\r\n</style>\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}